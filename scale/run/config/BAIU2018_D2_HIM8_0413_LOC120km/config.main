#!/bin/bash
#===============================================================================
#
#  Main settings for SCALE-LETKF scripts
#
#===============================================================================

PRESET='K_rankdir'                           # 'K' or 'K_rankdir' or 'K_micro'
#PRESET='K_micro'
#PRESET='K'

EXP=BAIU2018_D2_HIM8_0413_LOC120km

EXP_REF=BAIU2018_D2_NOHIM8_0413
# CHECK
PEXP="/volume63/data/hp120282_2/honda/SCALE-LETKF/scale-5.2.6/OUTPUT/exp_d1_5.2.6_tv_20190327"

USERNAME=honda

# -- H08 --
# -- RTTOV_DIR --
DIR_RTTOV=/volume63/data/hp120282_2/honda/SCALE-LETKF/RTTOV
RTTOV_COEF=${DIR_RTTOV}/rtcoef_rttov11/rttov7pred54L/rtcoef_himawari_8_ahi.dat
RTTOV_SCCOEF=${DIR_RTTOV}/rtcoef_rttov11/cldaer/sccldcoef_himawari_8_ahi.dat

#===============================================================================

DIR="$(cd "$(pwd)/.." && pwd)"              # Root directory of the SCALE-LETKF

OUTDIR="/volume63/data/hp120282_2/honda/SCALE-LETKF/scale-5.2.6/OUTPUT/BAIU2018_D2/${EXP}"


OUTDIR_REF="/volume63/data/hp120282_2/honda/SCALE-LETKF/scale-5.2.6/OUTPUT/BAIU2018_D2/${EXP_REF}"

#===============================================================================
# Location of model/data files

SCALEDIR="$DIR/../.."       # Directory of the SCALE model
DATADIR="/volume63/data/hp120282_2/honda/SCALE-LETKF/database"

<<<<<<< HEAD:scale/run/config/BAIU2018_D2_HIM8_0413_LOC120km/config.main
DATA_TOPO=${OUTDIR_REF}
DATA_TOPO_BDY_SCALE=${PEXP}/const/topo
DATA_LANDUSE=${OUTDIR_REF}
DATA_BDY_SCALE=${PEXP} 
=======
DATA_TOPO=
#DATA_TOPO_BDY_SCALE="/volume63/data/hp150019/gylien/exp/scale-letkf/BDA_case130713/d3_1km_312/const/topo"
DATA_LANDUSE=
#DATA_BDY_SCALE="/volume63/data/hp150019/gylien/exp/scale-letkf/BDA_case130713/d3_1km_312"
DATA_BDY_SCALE_PRC_NUM_X=3
DATA_BDY_SCALE_PRC_NUM_Y=3
>>>>>>> master5.3.X:scale/run/config/BDA_d4_250m_720p_bf40/config.main.K
DATA_BDY_SCALE_PREP=
DATA_BDY_WRF=
DATA_BDY_NICAM=
DATA_BDY_GRADS=


# CHECK
OBS="/volume63/data/hp120282_2/honda/SCALE-LETKF/scale-5.2.6/OUTPUT/BAIU2018_D2/obs_every10min/exp_d2_Him8_ll_TV_0327"

OBSNCEP=

#===============================================================================
# model/data file options

PNETCDF=0               # 0: Do not use PnetCDF
                        # 1: Use PnetCDF

PNETCDF_BDY_SCALE=0     # Use PNETCDF I/O for the parent domain SCALE data? (default: $PNETCDF)
                        # 0: Do not use PnetCDF
                        # 1: Use PnetCDF

DET_RUN=1               # 0: Disable the deterministic run
                        # 1: Enable  the deterministic run

TOPO_FORMAT='prep'   # 'prep': Use prepared topo files in $DATA_TOPO
#TOPO_FORMAT='GTOPO30'   # 'prep': Use prepared topo files in $DATA_TOPO
                        # 'GTOPO30' (requires compatible 'config.nml.scale_pp')
                        # 'DEM50M'  (requires compatible 'config.nml.scale_pp')

LANDUSE_FORMAT='prep' # 'prep': Use prepared landuse files in $DATA_LANDUSE
#LANDUSE_FORMAT='GLCCv2' # 'prep': Use prepared landuse files in $DATA_LANDUSE
                        # 'GLCCv2' (requires compatible 'config.nml.scale_pp')
                        # 'LU100M' (requires compatible 'config.nml.scale_pp')
LANDUSE_UPDATE=0        # 0: Time-invariant landuse files
                        # 1: Time-variant landuse files

BDY_FORMAT=1            # 0: SCALE boundary files (with exactly same domain settings; do not need additional preprocessing)
                        # 1: SCALE history (requires compatible 'config.nml.scale_init')
                        # 2: WRF           (requires compatible 'config.nml.scale_init')
                        # 3: NICAM         (requires compatible 'config.nml.scale_init')
                        # 4: GrADS         (requires compatible 'config.nml.scale_init')
BDY_SINGLE_FILE=0       # 0: Length of a boundary file = $BDYCYCLE_INT (e.g., files made by data assimilation cycles)
                        # 1: Length of a boundary file is long enough so that only a single boundary file is used for each forecast

BDY_SCALE_DIR='hist'    # Directory name of the SCALE history files when $BDY_FORMAT = 1
# only for 00-03UTC 7/1 (simply because "hist" data were not stored)



BDY_ENS=1               # 0: Fixed boundary files for all memebers
                        # 1: Ensemble boundary files
BDY_ROTATING=0 # ANALYSIS          # 0: Use a same series of boundary files for all initial time
                        # 1: Use different series of boundary files for different initial time

BDY_OCEAN_ONETIME=1

SKIP_BDYINIT=1 # 1: Skip unnecessary scale_init process
               # 0: Run scale_init every cycle

# FCST
#BDY_SINGLE_FILE=1
#BDY_SCALE_DIR='fcst'
#BDY_ROTATING=1


BDYINT=3600
BDYCYCLE_INT=21600

PARENT_REF_TIME=

ENABLE_PARAM_USER=0     # 0: Do not enable the 'PARAM_USER' section of the SCALE namelist
                        # 1: Enable the 'PARAM_USER' section of the SCALE namelist (require 'config.nml.scale_user' and customized version of SCALE)

OCEAN_INPUT=0           # 0: No ocean input (use cycling ocean variables)
                        # 1: Update the ocean variables every cycle
OCEAN_FORMAT=99         # 0: SCALE init files (with exactly same domain settings; do not need additional preprocessing)
                        # 99: From the same file as used in generating the boundary conditions ($BDY_FORMAT)
LAND_INPUT=0            # 0: No land input (use cycling land variables)
                        # 1: Update the land variables every cycle
LAND_FORMAT=99          # 0: SCALE init files (with exactly same domain settings; do not need additional preprocessing)
                        # 99: From the same file as used in generating the boundary conditions ($BDY_FORMAT)

OBSNUM=2
OBSNAME[1]=obs
OBSFOOT[1]="dat"
OBSNAME[2]=H08_ll
OBSFOOT[2]="nc"

#===============================================================================
# Cycling settings

WINDOW_S=600     # SCALE forecast time when the assimilation window starts (second)
WINDOW_E=600     # SCALE forecast time when the assimilation window ends (second)
LCYCLE=600       # Length of a DA cycle (second)
LTIMESLOT=600     # Timeslot interval for 4D-LETKF (second)


#===============================================================================
# Parallelization settings


MEMBER=50         # Ensemble size
NNODES=1872   # Number of nodes


PPN=1              # Number of processes per node

THREADS=8          # Number of threads per process

SCALE_NP=144        # Number of processes to run SCALE

BGJOB_INT='0.1s'   # Interval of multiple background job submissions

#===============================================================================
# Temporary directories to store runtime files

ONLINE_STGOUT=0             # Stage out right after each cycle (do not wait until the end of the job)?
                            #  0: No
                            #  1: Yes

SYSNAME="$(basename $OUTDIR)"                # A unique name in the machine
TMPSUBDIR="scale-letkf_${SYSNAME}"           # (used to identify multiple runs in the same time)

TMP="/scratch/$(echo $(id -ng)|cut -c 1-8)/${USERNAME}/$TMPSUBDIR" # Temporary directory shared among all nodes
TMPS="$DIR/tmp/$TMPSUBDIR"  # Temporary directory only on the server node
#TMPL=

CLEAR_TMP=0                 # Clear temporary directories after the completion of job?
                            #  0: No
                            #  1: Yes

#===============================================================================
# Environmental settings

MPIRUN="mpiexec"
if (which $MPIRUN > /dev/null 2>&1); then
  MPIRUN=$(which $MPIRUN)
fi

SCP='cp -L'
SCP_HOSTPREFIX=''
#SCP="scp -q"
#SCP_HOSTPREFIX="XXXX:"

STAGE_THREAD=8
TAR_THREAD=8

PYTHON="python"

#BUFRBIN=

#===============================================================================
# Machine-independent source file

. config.rc

#===============================================================================
