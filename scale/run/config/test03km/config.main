#!/bin/bash
#===============================================================================
#  For downscaling/forecast two things to change: outdir + bdyclycle_int
#  Main settings for SCALE-LETKF scripts
#  !Adjust for downscaling....!
#===============================================================================

RSCGRP='debug-flat'
RSCGRP='regular-flat'

PRESET='K_micro'

EXP="test03km"

USERNAME=honda

# -- H08 --
# -- RTTOV_DIR --
DIR_RTTOV=/work/hp150019/share/honda/RTTOV12.3_HDF
#/volume64/data/ra001011/honda/RTTOV12.2_netcdf
RTTOV_COEF=${DIR_RTTOV}/rtcoef_rttov12/rttov7pred54L/rtcoef_himawari_8_ahi.dat
RTTOV_SCCOEF=${DIR_RTTOV}/rtcoef_rttov12/cldaer_ir/sccldcoef_himawari_8_ahi.dat

RTTOV_MFCOEF=${DIR_RTTOV}/rtcoef_rttov12/mfasis_lut/rttov_mfasis_cld_himawari_8_ahi_opac.H5
RTTOV_SCCOEF_VIS=${DIR_RTTOV}/rtcoef_rttov12/cldaer_visir/sccldcoef_himawari_8_ahi.dat
RTTOV_COEF_VIS=${DIR_RTTOV}/rtcoef_rttov12/rttov9pred54L/rtcoef_himawari_8_ahi.dat


#INDIR="/volume64/data/ra001011/tnecker/experiments/germany_3km_15h_fcst_1000m"
#OUTDIR="/volume64/data/ra001011/${USERNAME}/SCALE-LETKF/VIS_TEST/OUTPUT/${EXP}"

INDIR="/work/hp150019/share/honda/LMU/experiments/germany_3km_15h_en_fcst_1000m"
OUTDIR="/work/hp150019/share/honda/LMU/experiments/germany_3km_15h_en_fcst_1000m/20160601120000/obssim"

#===============================================================================
# Location of model/data files

MODELDIR="$DIR/../../bin"                                            # Directory of the SCALE model executables
DATADIR="/volume64/data/ra001011/tnecker/database"                                             # Directory of the SCALE database

DATA_TOPO=                                                           # Directory of the prepared topo files
DATA_TOPO_BDY_SCALE="/volume64/data/ra001011/tnecker/experiments/germany_3km_15h_en_fcst_1000m/const/topo/"
DATA_LANDUSE=                                                        # Directory of the prepared landuse files
DATA_BDY_SCALE="/volume64/data/ra001011/tnecker/experiments/germany_15km_3h_en_cycle_1000m/" # Directory of the boundary data in SCALE history format (parent domain)
DATA_BDY_SCALE_PREP=                                                 # Directory of the prepared SCALE boundary files
DATA_BDY_WRF=                                                        # Directory of the boundary data in WRF format
DATA_BDY_NICAM=                                                      # Directory of the boundary data in NICAM format (not finished)
#DATA_BDY_GRADS="$DDIR/ncepfnl_grads"                                 # Directory of the boundary data in GrADS format
#OBS="/volume64/data/ra001011/gstefan/OBS/prepbufr_europe_scale/scale_1hr"                  # Observation data in LETKF observation format
OBSNCEP=

#===============================================================================
# model/data file options

TOPO_FORMAT='GTOPO30'   # 'prep': Use prepared topo files in $DATA_TOPO
                        # 'GTOPO30' (requires compatible 'config.nml.scale_pp')
                        # 'DEM50M'  (requires compatible 'config.nml.scale_pp')

LANDUSE_FORMAT='GLCCv2' # 'prep': Use prepared landuse files in $DATA_LANDUSE
                        # 'GLCCv2' (requires compatible 'config.nml.scale_pp')
                        # 'LU100M' (requires compatible 'config.nml.scale_pp')
LANDUSE_UPDATE=0        # 0: Time-invariant landuse files
                        # 1: Time-variant landuse files

BDY_FORMAT=1            # 0: SCALE boundary files (with exactly same domain settings; do not need additional preprocessing)
                        # 1: SCALE history (requires compatible 'config.nml.scale_init')
                        # 2: WRF           (requires compatible 'config.nml.scale_init')
                        # 3: NICAM         (requires compatible 'config.nml.scale_init')
                        # 4: GrADS         (requires compatible 'config.nml.scale_init')
BDY_SINGLE_FILE=1 #0       # 0: Length of a boundary file = $BDYCYCLE_INT (e.g., files made by data assimilation cycles)
                        # 1: Length of a boundary file is long enough so that only a single boundary file is used for each forecast
BDY_SCALE_DIR='fcst' #'hist'    # Directory name of the SCALE history files when $BDY_FORMAT = 1

BDY_ENS=1               # 0: Fixed boundary files for all memebers
                        # 1: Ensemble boundary files
BDY_ROTATING=1 #0         # 0: Use a same series of boundary files for all initial time
                        # 1: Use different series of boundary files for different initial time

BDYINT=3600		#for small domain set it to 1h frequency!!	
BDYCYCLE_INT=3600
#BDYCYCLE_INT=10800	#for DOWNSCALING!!!
#BDYCYCLE_INT=21600	#for small domain set it to 6 h frequency!!

PARENT_REF_TIME=20160607120000

ENABLE_PARAM_USER=0     # 0: Do not enable the 'PARAM_USER' section of the SCALE namelist
                        # 1: Enable the 'PARAM_USER' section of the SCALE namelist (require 'config.nml.scale_user' and customized version of SCALE)

OCEAN_INPUT=1           # 0: No ocean input (use cycling ocean variables)
                        # 1: Update the ocean variables every cycle
OCEAN_FORMAT=99         # 0: SCALE init files (with exactly same domain settings; do not need additional preprocessing)
                        # 99: From the same file as used in generating the boundary conditions ($BDY_FORMAT)
LAND_INPUT=1            # 0: No land input (use cycling land variables)
                        # 1: Update the land variables every cycle
LAND_FORMAT=99          # 0: SCALE init files (with exactly same domain settings; do not need additional preprocessing)
                        # 99: From the same file as used in generating the boundary conditions ($BDY_FORMAT)

OBSNUM=1
OBSNAME[1]=obs                                    
OBSNAME[2]=radar
OBSOPE_SEPARATE[1]=0
OBSOPE_SEPARATE[2]=0

#===============================================================================
# Cycling settings

WINDOW_S=3600     # SCALE forecast time when assimilation window starts (second)
WINDOW_E=3600     #14400  #3600 # SCALE forecast time when assimilation window ends (second)
LCYCLE=3600      #10800      # Length of a GFS-LETKF cycle (second)
LTIMESLOT=3600     # Timeslot interval for 4D-LETKF (second)

#===============================================================================
# Parallelization settings

MEMBER=1000 #1000         # Ensemble size

NNODES=8 
PPN=64               # Number of processes per node
PPN=32               # Number of processes per node
PPN=8               # Number of processes per node

THREADS=1           # Number of threads per process

SCALE_NP=8          # Number of processes to run SCALE

BGJOB_INT='0.1s'    # Interval of multiple background job submissions

#ENABLE_SET=1       ######

#===============================================================================
# Temporary directories to store runtime files

DATA_BDY_TMPLOC=1           # Location of the temporary directory for DATA_BDY
                            #  1: in $TMPDAT
                            #  2: in $TMPOUT

DISK_MODE_TOPO_LANDUSE_DB=2

DISK_MODE_DATA_BDY=2

DISK_MODE_DATA_TOPO=2
DISK_MODE_DATA_LANDUSE=2
DISK_MODE_DATA_BDYPREP=2

ONLINE_STGOUT=0             # Stage out right after each cycle (do not wait until the end of the job)?
                            #  0: No
                            #  1: Yes

#SIMPLE_STGOUT=1             # Stage out the entire 'out' temporary directory instead of specifying each file?
#                            #  0: No
#                            #  1: Yes

SYSNAME="$(basename $OUTDIR)"                # A unique name in the machine
TMPSUBDIR="scale-letkf_${SYSNAME}" # (used to identify multiple runs in the same time)

TMP="/scratch/$(echo $(id -ng)|cut -c 1-8)/${USERNAME}/$TMPSUBDIR" # Temporary directory shared among all nodes

TMPS="$DIR/tmp/$TMPSUBDIR"  # Temporary directory only on the server node
#TMPL=

CLEAR_TMP=0                 # Clear temporary directories after the completion of job?
                            #  0: No
                            #  1: Yes

#===============================================================================
# Environmental settings

MPIRUN="mpiexec"
if (which $MPIRUN > /dev/null 2>&1); then
  MPIRUN=$(which $MPIRUN)
fi

SCP='cp -L'
SCP_HOSTPREFIX=''
#SCP="scp -q"
#SCP_HOSTPREFIX="XXXX:"

SCP_THREAD=8
TAR_THREAD=8

PYTHON="python"

#BUFRBIN=

#===============================================================================
# Machine-independent source file

. config.rc

#===============================================================================
